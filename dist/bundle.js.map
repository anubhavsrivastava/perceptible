{"version":3,"sources":["webpack://Perceptor/webpack/universalModuleDefinition","webpack://Perceptor/webpack/bootstrap","webpack://Perceptor/./src/config/defaultConfig.js","webpack://Perceptor/./src/config/helper.js","webpack://Perceptor/./src/subscribers/domSubscriber.js","webpack://Perceptor/./src/utils/view.js","webpack://Perceptor/./src/spectators/viewportSpectator.js","webpack://Perceptor/./src/spectators/timeSpectator.js","webpack://Perceptor/./src/spectators/elementSpectator.js","webpack://Perceptor/./src/spectators/durationSpectator.js","webpack://Perceptor/./src/spectators/defaultSpectators.js","webpack://Perceptor/./src/spectators/spectatorManager.js","webpack://Perceptor/./src/subscribers/subscriberManager.js","webpack://Perceptor/./src/schedulers/visibilityHelper.js","webpack://Perceptor/./src/schedulers/intervalScheduler.js","webpack://Perceptor/./src/index.js"],"names":["root","factory","exports","module","define","amd","window","installedModules","__webpack_require__","moduleId","i","l","modules","call","m","c","d","name","getter","o","Object","defineProperty","enumerable","get","r","Symbol","toStringTag","value","t","mode","__esModule","ns","create","key","bind","n","object","property","prototype","hasOwnProperty","p","s","defaultConfig","threshold","scheduler","interval","attentionMode","viewOffset","top","left","right","bottom","subscribers","spectators","clickHandler","arrayMergeList","objectMergeList","isArray","candidate","Array","mainContainer","document","createElement","id","body","appendChild","style","backgroundColor","width","position","opacity","currentElementContainers","createOrUpdateElementContainer","context","innerHTML","JSON","stringify","undefined","paintObjectOnContainer","domSubscriber","perceptorInstance","element","getCurrentViewport","documentElement","clientHeight","getCurrentScrollPosition","height","clientWidth","pageXOffset","pageYOffset","getCurrentViewportElementPosition","node","getBoundingClientRect","getElementPosition","scrollPos","viewPortSpectator","ele","view","isBoxed","config","container","nodeRight","nodeBottom","containerLeft","containerTop","containerRight","containerBottom","leftCoordinates","rightCoordinates","topCoordinates","bottomCoordinates","subView","lc","rc","tc","bc","hasIntersectingArea","surface","isVisible","timeSpectator","time","Date","getTime","elementSpectator","pContext","tagName","durationSpectator","currentResult","prevResult","duration","defaultSpectators","SpectatorManager","[object Object]","chain","this","fn","push","length","perceptorContext","updatedResult","reduce","spectator","assign","SubscriberManager","PerceptorContext","data","every","subscribe","visibilityHelper_hidden","visibilityChange","hidden","msHidden","webkitHidden","onPageVisibilityChange","lastVisibility","addEventListener","currentVisibility","isPageVisible","intervalScheduler_IntervalScheduler","options","spectatorChain","subscriberChain","_enabled","_schedule","handleId","clearInterval","setInterval","spectatorsResult","run","dispatch","src_Perceptor","DOMElement","baseConfig","extensionConfig","includes","mergeConfig","defaults","event","clearSchedule","removeEventListener","__webpack_exports__"],"mappings":"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","file":"bundle.js","sourcesContent":["(function webpackUniversalModuleDefinition(root, factory) {\n\tif(typeof exports === 'object' && typeof module === 'object')\n\t\tmodule.exports = factory();\n\telse if(typeof define === 'function' && define.amd)\n\t\tdefine(\"Perceptor\", [], factory);\n\telse if(typeof exports === 'object')\n\t\texports[\"Perceptor\"] = factory();\n\telse\n\t\troot[\"Perceptor\"] = factory();\n})(window, function() {\nreturn "," \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, { enumerable: true, get: getter });\n \t\t}\n \t};\n\n \t// define __esModule on exports\n \t__webpack_require__.r = function(exports) {\n \t\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n \t\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n \t\t}\n \t\tObject.defineProperty(exports, '__esModule', { value: true });\n \t};\n\n \t// create a fake namespace object\n \t// mode & 1: value is a module id, require it\n \t// mode & 2: merge all properties of value into the ns\n \t// mode & 4: return value when already ns object\n \t// mode & 8|1: behave like require\n \t__webpack_require__.t = function(value, mode) {\n \t\tif(mode & 1) value = __webpack_require__(value);\n \t\tif(mode & 8) return value;\n \t\tif((mode & 4) && typeof value === 'object' && value && value.__esModule) return value;\n \t\tvar ns = Object.create(null);\n \t\t__webpack_require__.r(ns);\n \t\tObject.defineProperty(ns, 'default', { enumerable: true, value: value });\n \t\tif(mode & 2 && typeof value != 'string') for(var key in value) __webpack_require__.d(ns, key, function(key) { return value[key]; }.bind(null, key));\n \t\treturn ns;\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(__webpack_require__.s = 0);\n","const config = {\n\t//\n\t//This denotes the threshold (Percentage) of surface area that an Element is considered to be visible\n\t// e.g, a. if threshold is 100, & if 100% of the Element is visible, it will be considered as visible\n\t// \t\tb. if threshold is 20, & %age element visibility >20 , it will be considered as visible\n\t// defaults to 100\n\tthreshold: 100,\n\n\t// scheduler config\n\tscheduler: {\n\t\tmode: 'interval', // interval, scroll, raf, observer\n\t\t// currently on interval is supported\n\t\tinterval: 500, // ms of interval time, applicable for only \"interval\" type of mode\n\t\tattentionMode: true // Mode to disable schedulers if browser if not in focus (although visible on the screen)\n\t},\n\n\tviewOffset: {\n\t\ttop: 0, //px\n\t\tleft: 0, //px\n\t\tright: 0, //px\n\t\tbottom: 0 //px\n\t},\n\n\tsubscribers: [],\n\tspectators: [],\n\tclickHandler: () => {}\n};\n\nexport default config;\n","const arrayMergeList = ['subscribers', 'spectators'];\nconst objectMergeList = ['scheduler', 'viewOffset'];\n\nconst isArray = candidate => {\n\treturn Array.isArray(candidate);\n};\nexport function mergeConfig(baseConfig, extensionConfig) {\n\tif (extensionConfig) {\n\t\tfor (var key in extensionConfig) {\n\t\t\tif (arrayMergeList.includes(key)) {\n\t\t\t\textensionConfig[key] = isArray(extensionConfig[key]) ? extensionConfig[key] : [extensionConfig[key]];\n\t\t\t\tbaseConfig[key] = baseConfig[key] || [];\n\t\t\t\tbaseConfig[key] = isArray(baseConfig[key]) ? baseConfig[key] : [baseConfig[key]];\n\t\t\t\textensionConfig[key] = [...baseConfig[key], ...extensionConfig[key]];\n\t\t\t\tcontinue;\n\t\t\t}\n\n\t\t\tif (objectMergeList.includes(key)) {\n\t\t\t\tbaseConfig[key] = baseConfig[key] || {};\n\t\t\t\textensionConfig[key] = Object.assign({}, baseConfig[key], extensionConfig[key]);\n\t\t\t\tcontinue;\n\t\t\t}\n\t\t}\n\t}\n\n\treturn Object.assign({}, baseConfig, extensionConfig);\n}\n","// This reporter requires DOM Element which will be Absolute display,\n\nconst mainContainer = document.createElement('div');\nmainContainer.id = 'dreporter';\ndocument.body.appendChild(mainContainer);\n\nmainContainer.style.backgroundColor = '#e5e5e5';\nmainContainer.style.width = 'auto';\nmainContainer.style.position = 'fixed';\nmainContainer.style.bottom = '0';\nmainContainer.style.left = '0';\nmainContainer.style.opacity = '0.8';\n\nvar paintObjectOnContainer = function(o) {\n\treturn `<pre>${JSON.stringify(o, undefined, 4)}</pre>`;\n};\n\nconst currentElementContainers = {};\nconst createOrUpdateElementContainer = (id, context) => {\n\tif (!currentElementContainers[id]) {\n\t\tcurrentElementContainers[id] = document.createElement('div');\n\t\tmainContainer.appendChild(currentElementContainers[id]);\n\t}\n\tcurrentElementContainers[id].innerHTML = paintObjectOnContainer(context);\n};\nexport default (perceptorInstance, context) => {\n\treturn createOrUpdateElementContainer(perceptorInstance.element.id, context);\n};\n","export const getCurrentViewport = function() {\n\tif (document.documentElement && document.documentElement.clientHeight) {\n\t\treturn { ...getCurrentScrollPosition(), height: document.documentElement.clientHeight, width: document.documentElement.clientWidth };\n\t}\n\treturn { left: 0, right: 0, width: 0, height: 0 };\n};\n\nexport const getCurrentScrollPosition = function() {\n\treturn { left: window.pageXOffset, top: window.pageYOffset };\n};\n\nexport const getElementPosition = function(node) {\n\tlet position = node.getBoundingClientRect();\n\treturn { left: position.left, top: position.top, height: position.height, width: position.width };\n};\n\nexport const getCurrentViewportElementPosition = function(node) {\n\tlet position = getElementPosition(node);\n\tlet scrollPos = getCurrentScrollPosition();\n\treturn { left: position.left + scrollPos.left, top: position.top + scrollPos.top, height: position.height, width: position.width };\n};\n","import { getCurrentViewportElementPosition, getCurrentViewport } from '../utils/view';\n\nconst hasIntersectingArea = (lc, rc, tc, bc) => {\n\treturn (lc && tc) || (lc && bc) || (rc && tc) || (rc && bc);\n};\n\nexport default function viewPortSpectator(context) {\n\tlet ele = getCurrentViewportElementPosition(context.element);\n\tlet view = getCurrentViewport();\n\treturn isBoxed(view, ele, context.config);\n}\n\nexport const isBoxed = function(container, node, config) {\n\tconst threshold = config && config['threshold'] !== undefined ? config.threshold : 100;\n\t// todo: validate viewOffset values\n\tconst { viewOffset = { top: 0, left: 0, right: 0, bottom: 0 } } = config;\n\n\tconst nodeRight = node.left + node.width;\n\tconst nodeBottom = node.top + node.height;\n\n\tconst containerLeft = container.left + viewOffset.left;\n\tconst containerTop = container.top + viewOffset.top;\n\tconst containerRight = containerLeft + container.width - viewOffset.right;\n\tconst containerBottom = containerTop + container.height - viewOffset.bottom;\n\n\tconst leftCoordinates = node.left >= containerLeft && node.left <= containerRight;\n\tconst rightCoordinates = nodeRight <= containerRight && nodeRight >= containerLeft;\n\tconst topCoordinates = node.top >= containerTop && node.top <= containerBottom;\n\tconst bottomCoordinates = nodeBottom <= containerBottom && nodeBottom > containerTop;\n\n\tconst subView = {};\n\n\tif (hasIntersectingArea(leftCoordinates, rightCoordinates, topCoordinates, bottomCoordinates)) {\n\t\tsubView.left = leftCoordinates ? node.left : containerLeft;\n\t\tsubView.right = rightCoordinates ? nodeRight : containerRight;\n\t\tsubView.top = topCoordinates ? node.top : containerTop;\n\t\tsubView.bottom = bottomCoordinates ? nodeBottom : containerBottom;\n\t\tsubView.surface = ((((subView.right - subView.left) / node.width) * (subView.bottom - subView.top)) / node.height) * 100;\n\t}\n\n\treturn { isVisible: subView.surface >= threshold, subView };\n};\n","export default function timeSpectator() {\n\treturn { time: new Date().getTime() };\n}\n","export default function elementSpectator(pContext) {\n\tconst { element = {} } = pContext;\n\treturn { element: { id: element.id, tagName: element.tagName } };\n}\n","export default function durationSpectator(context, currentResult, prevResult) {\n\t/***\n\t *\n\t * This spectator depends on viewportSpectator and time spectator\n\t * Cases:\n\t * 1. Currently visible and previously not visible -> Just came under the view\n\t * 2. Currently visible and previously visible -> Add the count\n\t * 3. Currently not visible and previously not visible -> nothing to track\n\t * 4. Currently not visible and previously visible -> Got hidden\n\t *\n\t */\n\n\tlet { duration = 0 } = prevResult;\n\n\tif (currentResult.isVisible && prevResult.isVisible) {\n\t\tduration += context.config.scheduler.interval; //currentResult.time - prevResult.time;\n\t}\n\n\treturn { duration };\n}\n","import viewPortSpectator from './viewportSpectator';\nimport timeSpectator from './timeSpectator';\nimport elementSpectator from './elementSpectator';\nimport durationSpectator from './durationSpectator';\n\nconst getDefaultSpectators = () => {\n\treturn [timeSpectator, elementSpectator, viewPortSpectator, durationSpectator];\n};\n\nexport default getDefaultSpectators;\n","export default class SpectatorManager {\n\tconstructor(chain) {\n\t\tthis.chain = chain || [];\n\t\tthis.prevResult = {};\n\t}\n\n\tuse(fn) {\n\t\t//todo :check whether it is a function\n\t\tthis.chain.push(fn);\n\t\treturn this.chain.length - 1;\n\t}\n\n\teject(id) {\n\t\tif (this.chain[id]) {\n\t\t\tthis.chain[id] = null;\n\t\t}\n\t}\n\n\trun(perceptorContext) {\n\t\tconst updatedResult = this.chain.reduce((currentResult, spectator) => {\n\t\t\tif (spectator) {\n\t\t\t\t//todo check result is an object\n\t\t\t\tcurrentResult = Object.assign(currentResult, spectator(perceptorContext, currentResult, this.prevResult));\n\t\t\t}\n\t\t\treturn currentResult;\n\t\t}, Object.assign({}, this.prevResult));\n\t\tthis.prevResult = updatedResult;\n\t\treturn updatedResult;\n\t}\n}\n","export default class SubscriberManager {\n\tconstructor(chain) {\n\t\tthis.chain = chain || [];\n\t}\n\n\tuse(fn) {\n\t\t//todo :check whether it is a function\n\t\tthis.chain.push(fn);\n\t\treturn this.chain.length - 1;\n\t}\n\n\teject(id) {\n\t\tif (this.chain[id]) {\n\t\t\tthis.chain[id] = null;\n\t\t}\n\t}\n\n\tdispatch(PerceptorContext, data) {\n\t\tthis.chain.every(subscribe => {\n\t\t\tif (subscribe) {\n\t\t\t\tsubscribe(PerceptorContext, data);\n\t\t\t}\n\t\t\treturn true;\n\t\t});\n\t}\n}\n","// Refer : https://developer.mozilla.org/en-US/docs/Web/API/Page_Visibility_API\n// Shouldn't need a polyfill since it seems to be supported by major browsers\n// Refer caniuse for browser support: https://caniuse.com/#search=pagevisibility\n\n// Set the name of the hidden property and the change event for visibility\nlet hidden, visibilityChange;\nif (typeof document.hidden !== 'undefined') {\n\t// Opera 12.10 and Firefox 18 and later support\n\thidden = 'hidden';\n\tvisibilityChange = 'visibilitychange';\n} else if (typeof document.msHidden !== 'undefined') {\n\thidden = 'msHidden';\n\tvisibilityChange = 'msvisibilitychange';\n} else if (typeof document.webkitHidden !== 'undefined') {\n\thidden = 'webkitHidden';\n\tvisibilityChange = 'webkitvisibilitychange';\n}\n\nconst isPageVisible = () => {\n\treturn !document[hidden];\n};\n\n// const isPageHidden = () => {\n// \treturn document[hidden];\n// };\n\nexport const onPageVisibilityChange = (fn = () => {}, attentionMode = true) => {\n\tlet lastVisibility = undefined;\n\n\t// When window is switched over and switched back - both pageVisibilty API event and 'focus' event are triggered.\n\t// The callback handler in each event ensure that callback(fn) will be called only if there is\n\t// actual change in visibility by checking previousState(lastVisibility).\n\t// The sequence of execution isn't guaranteed but sequential execution is guaranteed in `task` in event loop\n\n\tdocument.addEventListener(visibilityChange, () => {\n\t\tlet currentVisibility = isPageVisible();\n\t\tif (lastVisibility != currentVisibility) {\n\t\t\tfn(currentVisibility);\n\t\t\tlastVisibility = currentVisibility;\n\t\t}\n\t});\n\n\tif (attentionMode) {\n\t\twindow.addEventListener('blur', () => {\n\t\t\tif (lastVisibility != false) {\n\t\t\t\tfn(false);\n\t\t\t\tlastVisibility = false;\n\t\t\t}\n\t\t});\n\n\t\twindow.addEventListener('focus', () => {\n\t\t\tif (lastVisibility != true) {\n\t\t\t\tfn(true);\n\t\t\t\tlastVisibility = true;\n\t\t\t}\n\t\t});\n\t}\n};\n","import { onPageVisibilityChange } from './visibilityHelper';\n\nexport default class IntervalScheduler {\n\tconstructor(options) {\n\t\t//todo: add validations here\n\t\tconst { config = { interval: 500, attentionMode: true }, spectatorChain, subscriberChain, context } = options;\n\t\tthis._enabled = true;\n\n\t\tthis._schedule(config.interval, spectatorChain, subscriberChain, context);\n\n\t\tonPageVisibilityChange(isPageVisible => {\n\t\t\tif (isPageVisible && this._enabled && !this.handleId) {\n\t\t\t\tthis._schedule(config.interval, spectatorChain, subscriberChain, context);\n\t\t\t} else if (this._enabled) {\n\t\t\t\tclearInterval(this.handleId);\n\t\t\t\tdelete this.handleId;\n\t\t\t}\n\t\t}, config.attentionMode);\n\t}\n\n\t_schedule(interval, spectatorChain, subscriberChain, context) {\n\t\tthis.handleId = setInterval(() => {\n\t\t\tconst spectatorsResult = spectatorChain.run(context);\n\t\t\treturn subscriberChain.dispatch(context, spectatorsResult);\n\t\t}, interval);\n\t}\n\n\tclearSchedule() {\n\t\tclearInterval(this.handleId);\n\t\tdelete this.handleId;\n\t\tthis._enabled = false;\n\t}\n}\n","import defaultConfig from './config/defaultConfig';\nimport { mergeConfig } from './config/helper';\nimport domSubscriber from './subscribers/domSubscriber';\nimport getDefaultSpectators from './spectators/defaultSpectators';\nimport SpectatorManager from './spectators/spectatorManager';\nimport SubscriberManager from './subscribers/subscriberManager';\nimport IntervalScheduler from './schedulers/intervalScheduler';\n\nclass Perceptor {\n\tconstructor(DOMElement, options = {}) {\n\t\tthis.element = DOMElement;\n\t\tthis.config = mergeConfig(Object.assign({}, defaultConfig, Perceptor.defaults, { subscribers: [domSubscriber], spectators: getDefaultSpectators() }), options);\n\t\tthis.spectatorChain = new SpectatorManager(this.config.spectators);\n\t\tthis.subscriberChain = new SubscriberManager(this.config.subscribers);\n\t\tthis.event = this.config.clickHandler ? this.config.clickHandler.bind(this, this) : () => {};\n\t}\n\n\twatch() {\n\t\tthis.scheduler = new IntervalScheduler({ context: this, subscriberChain: this.subscriberChain, spectatorChain: this.spectatorChain, config: this.config.scheduler });\n\t\tthis.element.addEventListener('click', this.event, false);\n\t}\n\n\tunwatch() {\n\t\tthis.scheduler.clearSchedule();\n\t\tthis.element.removeEventListener('click', this.event);\n\t}\n}\n\nPerceptor.defaults = Object.assign({}, defaultConfig);\n\nexport default Perceptor;\n"],"sourceRoot":""}