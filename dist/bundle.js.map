{"version":3,"sources":["webpack://Perceptor/webpack/universalModuleDefinition","webpack://Perceptor/webpack/bootstrap","webpack://Perceptor/./src/config/defaultConfig.js","webpack://Perceptor/./src/config/helper.js","webpack://Perceptor/./src/subscribers/domSubscriber.js","webpack://Perceptor/./src/utils/view.js","webpack://Perceptor/./src/spectators/viewportSpectator.js","webpack://Perceptor/./src/spectators/timeSpectator.js","webpack://Perceptor/./src/spectators/elementSpectator.js","webpack://Perceptor/./src/spectators/durationSpectator.js","webpack://Perceptor/./src/spectators/defaultSpectators.js","webpack://Perceptor/./src/spectators/spectatorManager.js","webpack://Perceptor/./src/subscribers/subscriberManager.js","webpack://Perceptor/./src/schedulers/visibilityHelper.js","webpack://Perceptor/./src/schedulers/intervalScheduler.js","webpack://Perceptor/./src/index.js"],"names":["root","factory","exports","module","define","amd","window","installedModules","__webpack_require__","moduleId","i","l","modules","call","m","c","d","name","getter","o","Object","defineProperty","enumerable","get","r","Symbol","toStringTag","value","t","mode","__esModule","ns","create","key","bind","n","object","property","prototype","hasOwnProperty","p","s","defaultConfig","threshold","scheduler","interval","attentionMode","viewOffset","top","left","right","bottom","subscribers","spectators","clickHandler","arrayMergeList","objectMergeList","isArray","candidate","Array","mainContainer","document","createElement","id","body","appendChild","style","backgroundColor","width","position","domSubscriber","perceptorInstance","context","innerHTML","JSON","stringify","undefined","paintObjectOnContainer","getCurrentViewport","documentElement","clientHeight","getCurrentScrollPosition","height","clientWidth","pageXOffset","pageYOffset","getCurrentViewportElementPosition","node","getBoundingClientRect","getElementPosition","scrollPos","viewPortSpectator","ele","element","view","isBoxed","config","container","nodeRight","nodeBottom","containerLeft","containerTop","containerRight","containerBottom","leftCoordinates","rightCoordinates","topCoordinates","bottomCoordinates","subView","lc","rc","tc","bc","hasIntersectingArea","surface","isVisible","timeSpectator","time","Date","getTime","elementSpectator","pContext","tagName","durationSpectator","currentResult","prevResult","duration","defaultSpectators","SpectatorManager","[object Object]","chain","this","fn","push","length","perceptorContext","updatedResult","reduce","spectator","assign","SubscriberManager","PerceptorContext","data","every","subscribe","visibilityHelper_hidden","visibilityChange","hidden","msHidden","webkitHidden","onPageVisibilityChange","lastVisibility","addEventListener","currentVisibility","isPageVisible","console","log","intervalScheduler_IntervalScheduler","options","spectatorChain","subscriberChain","_enabled","_schedule","handleId","clearInterval","setInterval","spectatorsResult","run","dispatch","src_Perceptor","DOMElement","baseConfig","extensionConfig","includes","mergeConfig","defaults","event","clearSchedule","removeEventListener","__webpack_exports__"],"mappings":"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","file":"bundle.js","sourcesContent":["(function webpackUniversalModuleDefinition(root, factory) {\n\tif(typeof exports === 'object' && typeof module === 'object')\n\t\tmodule.exports = factory();\n\telse if(typeof define === 'function' && define.amd)\n\t\tdefine(\"Perceptor\", [], factory);\n\telse if(typeof exports === 'object')\n\t\texports[\"Perceptor\"] = factory();\n\telse\n\t\troot[\"Perceptor\"] = factory();\n})(window, function() {\nreturn "," \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, { enumerable: true, get: getter });\n \t\t}\n \t};\n\n \t// define __esModule on exports\n \t__webpack_require__.r = function(exports) {\n \t\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n \t\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n \t\t}\n \t\tObject.defineProperty(exports, '__esModule', { value: true });\n \t};\n\n \t// create a fake namespace object\n \t// mode & 1: value is a module id, require it\n \t// mode & 2: merge all properties of value into the ns\n \t// mode & 4: return value when already ns object\n \t// mode & 8|1: behave like require\n \t__webpack_require__.t = function(value, mode) {\n \t\tif(mode & 1) value = __webpack_require__(value);\n \t\tif(mode & 8) return value;\n \t\tif((mode & 4) && typeof value === 'object' && value && value.__esModule) return value;\n \t\tvar ns = Object.create(null);\n \t\t__webpack_require__.r(ns);\n \t\tObject.defineProperty(ns, 'default', { enumerable: true, value: value });\n \t\tif(mode & 2 && typeof value != 'string') for(var key in value) __webpack_require__.d(ns, key, function(key) { return value[key]; }.bind(null, key));\n \t\treturn ns;\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(__webpack_require__.s = 0);\n","const config = {\n\t//\n\t//This denotes the threshold (Percentage) of surface area that an Element is considered to be visible\n\t// e.g, a. if threshold is 100, & if 100% of the Element is visible, it will be considered as visible\n\t// \t\tb. if threshold is 20, & %age element visibility >20 , it will be considered as visible\n\t// defaults to 100\n\tthreshold: 100,\n\n\t// scheduler config\n\tscheduler: {\n\t\tmode: 'interval', // interval, scroll, raf, observer\n\t\t// currently on interval is supported\n\t\tinterval: 500, // ms of interval time, applicable for only \"interval\" type of mode\n\t\tattentionMode: false // Mode to disable schedulers if browser if not in focus (although visible on the screen)\n\t},\n\n\tviewOffset: {\n\t\ttop: 0, //px\n\t\tleft: 0, //px\n\t\tright: 0, //px\n\t\tbottom: 0 //px\n\t},\n\n\tsubscribers: [],\n\tspectators: [],\n\tclickHandler: () => {}\n};\n\nexport default config;\n","const arrayMergeList = ['subscribers', 'spectators'];\nconst objectMergeList = ['scheduler', 'viewOffset'];\n\nconst isArray = candidate => {\n\treturn Array.isArray(candidate);\n};\nexport function mergeConfig(baseConfig, extensionConfig) {\n\tif (extensionConfig) {\n\t\tfor (var key in extensionConfig) {\n\t\t\tif (arrayMergeList.includes(key)) {\n\t\t\t\textensionConfig[key] = isArray(extensionConfig[key]) ? extensionConfig[key] : [extensionConfig[key]];\n\t\t\t\tbaseConfig[key] = baseConfig[key] || [];\n\t\t\t\tbaseConfig[key] = isArray(baseConfig[key]) ? baseConfig[key] : [baseConfig[key]];\n\t\t\t\textensionConfig[key] = [...baseConfig[key], ...extensionConfig[key]];\n\t\t\t\tcontinue;\n\t\t\t}\n\n\t\t\tif (objectMergeList.includes(key)) {\n\t\t\t\tbaseConfig[key] = baseConfig[key] || {};\n\t\t\t\textensionConfig[key] = Object.assign({}, baseConfig[key], extensionConfig[key]);\n\t\t\t\tcontinue;\n\t\t\t}\n\t\t}\n\t}\n\n\treturn Object.assign({}, baseConfig, extensionConfig);\n}\n","// This reporter requires DOM Element which will be Absolute display,\n\nconst mainContainer = document.createElement('div');\nmainContainer.id = 'dreporter';\ndocument.body.appendChild(mainContainer);\n\nmainContainer.style.backgroundColor = '#e5e5e5';\nmainContainer.style.width = 'auto';\nmainContainer.style.position = 'fixed';\nmainContainer.style.bottom = '0';\nmainContainer.style.left = '0';\n\nvar paintObjectOnContainer = function(o) {\n\treturn `<pre>${JSON.stringify(o, undefined, 4)}</pre>`;\n};\n\nexport default (perceptorInstance, context) => {\n\tmainContainer.innerHTML = paintObjectOnContainer(context);\n};\n","export const getCurrentViewport = function() {\n\tif (document.documentElement && document.documentElement.clientHeight) {\n\t\treturn { ...getCurrentScrollPosition(), height: document.documentElement.clientHeight, width: document.documentElement.clientWidth };\n\t}\n\treturn { left: 0, right: 0, width: 0, height: 0 };\n};\n\nexport const getCurrentScrollPosition = function() {\n\treturn { left: window.pageXOffset, top: window.pageYOffset };\n};\n\nexport const getElementPosition = function(node) {\n\tlet position = node.getBoundingClientRect();\n\treturn { left: position.left, top: position.top, height: position.height, width: position.width };\n};\n\nexport const getCurrentViewportElementPosition = function(node) {\n\tlet position = getElementPosition(node);\n\tlet scrollPos = getCurrentScrollPosition();\n\treturn { left: position.left + scrollPos.left, top: position.top + scrollPos.top, height: position.height, width: position.width };\n};\n","import { getCurrentViewportElementPosition, getCurrentViewport } from '../utils/view';\n\nconst hasIntersectingArea = (lc, rc, tc, bc) => {\n\treturn (lc && tc) || (lc && bc) || (rc && tc) || (rc && bc);\n};\n\nexport default function viewPortSpectator(context) {\n\tlet ele = getCurrentViewportElementPosition(context.element);\n\tlet view = getCurrentViewport();\n\treturn isBoxed(view, ele, context.config);\n}\n\nexport const isBoxed = function(container, node, config) {\n\tconst threshold = config && config['threshold'] !== undefined ? config.threshold : 100;\n\t// todo: validate viewOffset values\n\tconst { viewOffset = { top: 0, left: 0, right: 0, bottom: 0 } } = config;\n\n\tconst nodeRight = node.left + node.width;\n\tconst nodeBottom = node.top + node.height;\n\n\tconst containerLeft = container.left + viewOffset.left;\n\tconst containerTop = container.top + viewOffset.top;\n\tconst containerRight = containerLeft + container.width - viewOffset.right;\n\tconst containerBottom = containerTop + container.height - viewOffset.bottom;\n\n\tconst leftCoordinates = node.left >= containerLeft && node.left <= containerRight;\n\tconst rightCoordinates = nodeRight <= containerRight && nodeRight >= containerLeft;\n\tconst topCoordinates = node.top >= containerTop && node.top <= containerBottom;\n\tconst bottomCoordinates = nodeBottom <= containerBottom && nodeBottom > containerTop;\n\n\tconst subView = {};\n\n\tif (hasIntersectingArea(leftCoordinates, rightCoordinates, topCoordinates, bottomCoordinates)) {\n\t\tsubView.left = leftCoordinates ? node.left : containerLeft;\n\t\tsubView.right = rightCoordinates ? nodeRight : containerRight;\n\t\tsubView.top = topCoordinates ? node.top : containerTop;\n\t\tsubView.bottom = bottomCoordinates ? nodeBottom : containerBottom;\n\t\tsubView.surface = ((((subView.right - subView.left) / node.width) * (subView.bottom - subView.top)) / node.height) * 100;\n\t}\n\n\treturn { isVisible: subView.surface >= threshold, subView };\n};\n","export default function timeSpectator() {\n\treturn { time: new Date().getTime() };\n}\n","export default function elementSpectator(pContext) {\n\tconst { element = {} } = pContext;\n\treturn { element: { id: element.id, tagName: element.tagName } };\n}\n","export default function durationSpectator(context, currentResult, prevResult) {\n\t/***\n\t *\n\t * This spectator depends on viewportSpectator and time spectator\n\t * Cases:\n\t * 1. Currently visible and previously not visible -> Just came under the view\n\t * 2. Currently visible and previously visible -> Add the count\n\t * 3. Currently not visible and previously not visible -> nothing to track\n\t * 4. Currently not visible and previously visible -> Got hidden\n\t *\n\t */\n\n\tlet { duration = 0 } = prevResult;\n\n\tif (currentResult.isVisible && prevResult.isVisible) {\n\t\tduration += context.config.scheduler.interval; //currentResult.time - prevResult.time;\n\t}\n\n\treturn { duration };\n}\n","import viewPortSpectator from './viewportSpectator';\nimport timeSpectator from './timeSpectator';\nimport elementSpectator from './elementSpectator';\nimport durationSpectator from './durationSpectator';\n\nconst getDefaultSpectators = () => {\n\treturn [timeSpectator, elementSpectator, viewPortSpectator, durationSpectator];\n};\n\nexport default getDefaultSpectators;\n","export default class SpectatorManager {\n\tconstructor(chain) {\n\t\tthis.chain = chain || [];\n\t\tthis.prevResult = {};\n\t}\n\n\tuse(fn) {\n\t\t//todo :check whether it is a function\n\t\tthis.chain.push(fn);\n\t\treturn this.chain.length - 1;\n\t}\n\n\teject(id) {\n\t\tif (this.chain[id]) {\n\t\t\tthis.chain[id] = null;\n\t\t}\n\t}\n\n\trun(perceptorContext) {\n\t\tconst updatedResult = this.chain.reduce((currentResult, spectator) => {\n\t\t\tif (spectator) {\n\t\t\t\t//todo check result is an object\n\t\t\t\tcurrentResult = Object.assign(currentResult, spectator(perceptorContext, currentResult, this.prevResult));\n\t\t\t}\n\t\t\treturn currentResult;\n\t\t}, Object.assign({}, this.prevResult));\n\t\tthis.prevResult = updatedResult;\n\t\treturn updatedResult;\n\t}\n}\n","export default class SubscriberManager {\n\tconstructor(chain) {\n\t\tthis.chain = chain || [];\n\t}\n\n\tuse(fn) {\n\t\t//todo :check whether it is a function\n\t\tthis.chain.push(fn);\n\t\treturn this.chain.length - 1;\n\t}\n\n\teject(id) {\n\t\tif (this.chain[id]) {\n\t\t\tthis.chain[id] = null;\n\t\t}\n\t}\n\n\tdispatch(PerceptorContext, data) {\n\t\tthis.chain.every(subscribe => {\n\t\t\tif (subscribe) {\n\t\t\t\tsubscribe(PerceptorContext, data);\n\t\t\t}\n\t\t\treturn true;\n\t\t});\n\t}\n}\n","// Refer : https://developer.mozilla.org/en-US/docs/Web/API/Page_Visibility_API\n// Shouldn't need a polyfill since it seems to be supported by major browsers\n// Refer caniuse for browser support: https://caniuse.com/#search=pagevisibility\n\n// Set the name of the hidden property and the change event for visibility\nlet hidden, visibilityChange;\nif (typeof document.hidden !== 'undefined') {\n\t// Opera 12.10 and Firefox 18 and later support\n\thidden = 'hidden';\n\tvisibilityChange = 'visibilitychange';\n} else if (typeof document.msHidden !== 'undefined') {\n\thidden = 'msHidden';\n\tvisibilityChange = 'msvisibilitychange';\n} else if (typeof document.webkitHidden !== 'undefined') {\n\thidden = 'webkitHidden';\n\tvisibilityChange = 'webkitvisibilitychange';\n}\n\nconst isPageVisible = () => {\n\treturn !document[hidden];\n};\n\n// const isPageHidden = () => {\n// \treturn document[hidden];\n// };\n\nexport const onPageVisibilityChange = (fn = () => {}, attentionMode = true) => {\n\tlet lastVisibility = undefined;\n\n\t// When window is switched and switched back - both pageVisibilty API event and 'focus' event are triggered.\n\t// The callback handler in each event ensure that callback(fn) will be called only if there is\n\t// actual change in visibility by checking previousState(lastVisibility).\n\t// The sequence of execution isn't guaranteed but sequential execution is guaranteed in `task` in event loop\n\n\tdocument.addEventListener(visibilityChange, () => {\n\t\tlet currentVisibility = isPageVisible();\n\t\tconsole.log(currentVisibility, lastVisibility);\n\t\tif (lastVisibility != currentVisibility) {\n\t\t\tfn(currentVisibility);\n\t\t\tlastVisibility = currentVisibility;\n\t\t}\n\t});\n\n\tif (attentionMode) {\n\t\twindow.addEventListener('blur', () => {\n\t\t\tif (lastVisibility != false) {\n\t\t\t\tfn(false);\n\t\t\t\tlastVisibility = false;\n\t\t\t}\n\t\t});\n\n\t\twindow.addEventListener('focus', () => {\n\t\t\tif (lastVisibility != true) {\n\t\t\t\tfn(true);\n\t\t\t\tlastVisibility = true;\n\t\t\t}\n\t\t});\n\t}\n};\n","import { onPageVisibilityChange } from './visibilityHelper';\n\nexport default class IntervalScheduler {\n\tconstructor(options) {\n\t\t//todo: add validations here\n\t\tconst { config = { interval: 500, attentionMode: true }, spectatorChain, subscriberChain, context } = options;\n\t\tthis._enabled = true;\n\n\t\tthis._schedule(config.interval, spectatorChain, subscriberChain, context);\n\n\t\tonPageVisibilityChange(isPageVisible => {\n\t\t\tif (isPageVisible && this._enabled && !this.handleId) {\n\t\t\t\tthis._schedule(config.interval, spectatorChain, subscriberChain, context);\n\t\t\t} else if (this._enabled) {\n\t\t\t\tclearInterval(this.handleId);\n\t\t\t\tdelete this.handleId;\n\t\t\t}\n\t\t}, config.attentionMode);\n\t}\n\n\t_schedule(interval, spectatorChain, subscriberChain, context) {\n\t\tthis.handleId = setInterval(() => {\n\t\t\tconst spectatorsResult = spectatorChain.run(context);\n\t\t\treturn subscriberChain.dispatch(context, spectatorsResult);\n\t\t}, interval);\n\t}\n\n\tclearSchedule() {\n\t\tclearInterval(this.handleId);\n\t\tdelete this.handleId;\n\t\tthis._enabled = false;\n\t}\n}\n","import defaultConfig from './config/defaultConfig';\nimport { mergeConfig } from './config/helper';\nimport domSubscriber from './subscribers/domSubscriber';\nimport getDefaultSpectators from './spectators/defaultSpectators';\nimport SpectatorManager from './spectators/spectatorManager';\nimport SubscriberManager from './subscribers/subscriberManager';\nimport IntervalScheduler from './schedulers/intervalScheduler';\n\nclass Perceptor {\n\tconstructor(DOMElement, options = {}) {\n\t\tthis.element = DOMElement;\n\t\tthis.config = mergeConfig(Object.assign({}, defaultConfig, Perceptor.defaults, { subscribers: [domSubscriber], spectators: getDefaultSpectators() }), options);\n\t\tthis.spectatorChain = new SpectatorManager(this.config.spectators);\n\t\tthis.subscriberChain = new SubscriberManager(this.config.subscribers);\n\t\tthis.event = this.config.clickHandler ? this.config.clickHandler.bind(this, this) : () => {};\n\t}\n\n\twatch() {\n\t\tthis.scheduler = new IntervalScheduler({ context: this, subscriberChain: this.subscriberChain, spectatorChain: this.spectatorChain, config: this.config.scheduler });\n\t\tthis.element.addEventListener('click', this.event, false);\n\t}\n\n\tunwatch() {\n\t\tthis.scheduler.clearSchedule();\n\t\tthis.element.removeEventListener('click', this.event);\n\t}\n}\n\nPerceptor.defaults = Object.assign({}, defaultConfig);\n\nexport default Perceptor;\n"],"sourceRoot":""}