!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define("Perceptor",[],t):"object"==typeof exports?exports.Perceptor=t():e.Perceptor=t()}(window,function(){return function(e){var t={};function i(n){if(t[n])return t[n].exports;var r=t[n]={i:n,l:!1,exports:{}};return e[n].call(r.exports,r,r.exports,i),r.l=!0,r.exports}return i.m=e,i.c=t,i.d=function(e,t,n){i.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},i.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},i.t=function(e,t){if(1&t&&(e=i(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(i.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var r in e)i.d(n,r,function(t){return e[t]}.bind(null,r));return n},i.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return i.d(t,"a",t),t},i.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},i.p="",i(i.s=0)}([function(e,t,i){"use strict";i.r(t);var n={threshold:100,scheduler:{mode:"interval",interval:500,attentionMode:!0},viewOffset:{top:0,left:0,right:0,bottom:0},subscribers:[],spectators:[],clickHandler:()=>{},defaultSubscriber:"dom"};const r=["subscribers","spectators"],s=["scheduler","viewOffset"],o=e=>Array.isArray(e);const c=function(){return document.documentElement&&document.documentElement.clientHeight?{...l(),height:document.documentElement.clientHeight,width:document.documentElement.clientWidth}:{left:0,right:0,width:0,height:0}},l=function(){return{left:window.pageXOffset,top:window.pageYOffset}},d=function(e){let t=function(e){let t=e.getBoundingClientRect();return{left:t.left,top:t.top,height:t.height,width:t.width}}(e),i=l();return{left:t.left+i.left,top:t.top+i.top,height:t.height,width:t.width}};function h(e){let t=d(e.element),i=c();return u(i,t,e.config)}const u=function(e,t,i){const n=i&&void 0!==i.threshold?i.threshold:100,{viewOffset:r={top:0,left:0,right:0,bottom:0}}=i,s=t.left+t.width,o=t.top+t.height,c=e.left+r.left,l=e.top+r.top,d=c+e.width-r.right,h=l+e.height-r.bottom,u=t.left>=c&&t.left<=d,a=s<=d&&s>=c,f=t.top>=l&&t.top<=h,p=o<=h&&o>l,b={};return((e,t,i,n)=>e&&i||e&&n||t&&i||t&&n)(u,a,f,p)&&(b.left=u?t.left:c,b.right=a?s:d,b.top=f?t.top:l,b.bottom=p?o:h,b.surface=(b.right-b.left)/t.width*(b.bottom-b.top)/t.height*100),{isVisible:b.surface>=n,subView:b}};function a(){return{time:(new Date).getTime()}}function f(e){const{element:t={}}=e;return{element:{id:t.id,tagName:t.tagName}}}function p(e,t,i){let{duration:n=0}=i;return t.isVisible&&i.isVisible&&(n+=e.config.scheduler.interval),{duration:n}}var b=()=>[a,f,h,p];const m=document.createElement("div");m.id="dreporter",document.body.appendChild(m),m.style.backgroundColor="#e5e5e5",m.style.width="auto",m.style.position="fixed",m.style.bottom="0",m.style.left="0",m.style.opacity="0.8";const g={},v=(e,t)=>{g[e]||(g[e]=document.createElement("div"),m.appendChild(g[e])),g[e].innerHTML=function(e){return`<pre>${JSON.stringify(e,void 0,4)}</pre>`}(t)};var w=(e,t)=>v(e.element.id,t),y=function(e,t){console.log(t)};var O=e=>"dom"===e?w:"console"===e?y:()=>{};class j{constructor(e){this.chain=e||[],this.prevResult={}}use(e){return this.chain.push(e),this.chain.length-1}eject(e){this.chain[e]&&(this.chain[e]=null)}run(e){const t=this.chain.reduce((t,i)=>(i&&(t=Object.assign(t,i(e,t,this.prevResult)||{})),t),Object.assign({},this.prevResult));return this.prevResult=t,t}}class _{constructor(e){this.chain=e||[]}use(e){return this.chain.push(e),this.chain.length-1}eject(e){this.chain[e]&&(this.chain[e]=null)}dispatch(e,t){this.chain.every(i=>(i&&i(e,t),!0))}}let x,C;void 0!==document.hidden?(x="hidden",C="visibilitychange"):void 0!==document.msHidden?(x="msHidden",C="msvisibilitychange"):void 0!==document.webkitHidden&&(x="webkitHidden",C="webkitvisibilitychange");const E=(e=(()=>{}),t=!0)=>{let i=void 0;document.addEventListener(C,()=>{let t=(()=>!document[x])();i!=t&&(e(t),i=t)}),t&&(window.addEventListener("blur",()=>{0!=i&&(e(!1),i=!1)}),window.addEventListener("focus",()=>{1!=i&&(e(!0),i=!0)}))};class S{constructor(e){const{config:t={interval:500,attentionMode:!0},spectatorChain:i,subscriberChain:n,context:r}=e;this._enabled=!0,this._schedule(t.interval,i,n,r),E(e=>{e&&this._enabled&&!this.handleId?this._schedule(t.interval,i,n,r):this._enabled&&(clearInterval(this.handleId),delete this.handleId)},t.attentionMode)}_schedule(e,t,i,n){this.handleId=setInterval(()=>{const e=t.run(n);return i.dispatch(n,e)},e)}clearSchedule(){clearInterval(this.handleId),delete this.handleId,this._enabled=!1}}class H{constructor(e,t={}){this.element=e,this.config=function(e,t){if(t)for(var i in t)r.includes(i)?(t[i]=o(t[i])?t[i]:[t[i]],e[i]=e[i]||[],e[i]=o(e[i])?e[i]:[e[i]],t[i]=[...e[i],...t[i]]):s.includes(i)&&(e[i]=e[i]||{},t[i]=Object.assign({},e[i],t[i]));return Object.assign({},e,t)}(Object.assign({},n,H.defaults,{subscribers:[O(t.defaultSubscriber||H.defaults.defaultSubscriber)],spectators:b()}),t),this.spectatorChain=new j(this.config.spectators),this.subscriberChain=new _(this.config.subscribers),this.event=this.config.clickHandler?this.config.clickHandler.bind(this,this):()=>{}}watch(){return this.scheduler||(this.scheduler=new S({context:this,subscriberChain:this.subscriberChain,spectatorChain:this.spectatorChain,config:this.config.scheduler}),this.element.addEventListener("click",this.event,!1)),this}unwatch(){return this.scheduler&&(this.scheduler.clearSchedule(),delete this.scheduler,this.element.removeEventListener("click",this.event)),this}}H.defaults=Object.assign({},n);t.default=H}]).default});
//# sourceMappingURL=bundle.js.map