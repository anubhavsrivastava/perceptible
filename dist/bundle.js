!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e():"function"==typeof define&&define.amd?define("Perceptor",[],e):"object"==typeof exports?exports.Perceptor=e():t.Perceptor=e()}(window,function(){return function(t){var e={};function i(n){if(e[n])return e[n].exports;var r=e[n]={i:n,l:!1,exports:{}};return t[n].call(r.exports,r,r.exports,i),r.l=!0,r.exports}return i.m=t,i.c=e,i.d=function(t,e,n){i.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:n})},i.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},i.t=function(t,e){if(1&e&&(t=i(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var n=Object.create(null);if(i.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var r in t)i.d(n,r,function(e){return t[e]}.bind(null,r));return n},i.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return i.d(e,"a",e),e},i.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},i.p="",i(i.s=0)}([function(t,e,i){"use strict";i.r(e);var n={threshold:100,scheduler:{mode:"interval",interval:500},viewOffset:{top:0,left:0,right:0,bottom:0},subscribers:[],spectators:[],clickHandler:()=>{}};const r=["subscribers","spectators"],s=["scheduler","viewOffset"],o=t=>Array.isArray(t);const c=document.createElement("div");c.id="dreporter",document.body.appendChild(c),c.style.backgroundColor="#e5e5e5",c.style.width="auto",c.style.position="fixed",c.style.bottom="0",c.style.left="0";var h=(t,e)=>{c.innerHTML=function(t){return`<pre>${JSON.stringify(t,void 0,4)}</pre>`}(e)};const l=function(){return document.documentElement&&document.documentElement.clientHeight?{...u(),height:document.documentElement.clientHeight,width:document.documentElement.clientWidth}:{left:0,right:0,width:0,height:0}},u=function(){return{left:window.pageXOffset,top:window.pageYOffset}},d=function(t){let e=function(t){let e=t.getBoundingClientRect();return{left:e.left,top:e.top,height:e.height,width:e.width}}(t),i=u();return{left:e.left+i.left,top:e.top+i.top,height:e.height,width:e.width}};function a(t){let e=d(t.element),i=l();return f(i,e,t.config)}const f=function(t,e,i){const n=i&&void 0!==i.threshold?i.threshold:100,{viewOffset:r={top:0,left:0,right:0,bottom:0}}=i,s=e.left+e.width,o=e.top+e.height,c=t.left+r.left,h=t.top+r.top,l=c+t.width-r.right,u=h+t.height-r.bottom,d=e.left>=c&&e.left<=l,a=s<=l&&s>=c,f=e.top>=h&&e.top<=u,p=o<=u&&o>h,b={};return((t,e,i,n)=>t&&i||t&&n||e&&i||e&&n)(d,a,f,p)&&(b.left=d?e.left:c,b.right=a?s:l,b.top=f?e.top:h,b.bottom=p?o:u,b.surface=(b.right-b.left)/e.width*(b.bottom-b.top)/e.height*100),{isVisible:b.surface>=n,subView:b}};function p(){return{time:(new Date).getTime()}}function b(t){const{element:e={}}=t;return{element:{id:e.id,tagName:e.tagName}}}function m(t,e,i){let{duration:n=0}=i;return e.isVisible&&i.isVisible&&(n+=e.time-i.time),{duration:n}}var g=()=>[p,b,a,m];class v{constructor(t){this.chain=t||[],this.prevResult={}}use(t){return this.chain.push(t),this.chain.length-1}eject(t){this.chain[t]&&(this.chain[t]=null)}run(t){const e=this.chain.reduce((e,i)=>(i&&(e=Object.assign(e,i(t,e,this.prevResult))),e),Object.assign({},this.prevResult));return this.prevResult=e,e}}class w{constructor(t){this.chain=t||[]}use(t){return this.chain.push(t),this.chain.length-1}eject(t){this.chain[t]&&(this.chain[t]=null)}dispatch(t,e){this.chain.every(i=>(i&&i(t,e),!0))}}let y,O;void 0!==document.hidden?(y="hidden",O="visibilitychange"):void 0!==document.msHidden?(y="msHidden",O="msvisibilitychange"):void 0!==document.webkitHidden&&(y="webkitHidden",O="webkitvisibilitychange"),document[y];const j=(t=(()=>{}))=>{document.addEventListener(O,t,!1)},_=()=>!document[y];class x{constructor(t){const{interval:e=500,spectatorChain:i,subscriberChain:n,context:r}=t;this._enabled=!0,this._schedule(e,i,n,r),j(()=>{this._schedule(e,i,n,r)})}_schedule(t,e,i,n){_()&&this._enabled?this.handleId=setInterval(()=>{const t=e.run(n);return i.dispatch(n,t)},t):this._enabled&&clearInterval(this.handleId)}clearSchedule(){clearInterval(this.handleId),this._enabled=!1}}class C{constructor(t,e={}){this.element=t,this.config=function(t,e){if(e)for(var i in e)r.includes(i)?(e[i]=o(e[i])?e[i]:[e[i]],t[i]=t[i]||[],t[i]=o(t[i])?t[i]:[t[i]],e[i]=[...t[i],...e[i]]):s.includes(i)&&(t[i]=t[i]||{},e[i]=Object.assign({},t[i],e[i]));return Object.assign({},t,e)}(Object.assign({},n,C.defaults,{subscribers:[h],spectators:g()}),e),this.spectatorChain=new v(this.config.spectators),this.subscriberChain=new w(this.config.subscribers),this.event=this.config.clickHandler?this.config.clickHandler.bind(this,this):()=>{}}watch(){this.scheduler=new x({context:this,subscriberChain:this.subscriberChain,spectatorChain:this.spectatorChain,interval:this.config.scheduler.interval}),this.element.addEventListener("click",this.event,!1)}unwatch(){this.scheduler.clearSchedule(),this.element.removeEventListener("click",this.event)}}C.defaults=Object.assign({},n);e.default=C}]).default});
//# sourceMappingURL=bundle.js.map